#!/usr/bin/env bash
# Wrapper script that delegates to Rust or Bash implementation

# Find the real directory of this script (resolving symlinks)
get_script_dir() {
  local script_path="${BASH_SOURCE[0]}"
  local real_path
  real_path="$(readlink -f "$script_path" 2>/dev/null || realpath "$script_path" 2>/dev/null || echo "$script_path")"
  cd "$(dirname "$real_path")/.." && pwd
}

YX_ROOT="$(get_script_dir)"

# Check for Rust binary in target/release
RUST_YX="$YX_ROOT/target/release/yx"

if [ -x "$RUST_YX" ] && [ "${USE_BASH_YX:-0}" != "1" ]; then
  # Use Rust implementation
  exec "$RUST_YX" "$@"
else
  # Fall back to bash implementation
  exec "$YX_ROOT/bin/yx-bash" "$@"
fi
