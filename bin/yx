#!/usr/bin/env bash
# Wrapper script that delegates to Rust or Bash implementation

# Find the real directory of this script (resolving symlinks)
get_script_dir() {
  local script_path="${BASH_SOURCE[0]}"
  local real_path
  real_path="$(readlink -f "$script_path" 2>/dev/null || realpath "$script_path" 2>/dev/null || echo "$script_path")"
  cd "$(dirname "$real_path")/.." && pwd
}

YX_ROOT="$(get_script_dir)"

# Check for Rust binary in target/release or target/debug
RUST_YX="$YX_ROOT/target/release/yx"
RUST_YX_DEBUG="$YX_ROOT/target/debug/yx"

if [ "${USE_BASH_YX:-0}" = "1" ]; then
  # Explicitly use bash implementation
  exec "$YX_ROOT/bin/yx-bash" "$@"
elif [ -x "$RUST_YX" ]; then
  # Use Rust release implementation
  exec "$RUST_YX" "$@"
elif [ -x "$RUST_YX_DEBUG" ]; then
  # Use Rust debug implementation
  exec "$RUST_YX_DEBUG" "$@"
else
  # Fall back to bash implementation
  exec "$YX_ROOT/bin/yx-bash" "$@"
fi
