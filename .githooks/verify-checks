#!/usr/bin/env bash
# Verifies that dev check has been run recently
# Used by git hooks (pre-commit, pre-merge-commit, pre-push)

set -e

MARKER=".last-checked"

# Check if marker file exists
if [ ! -f "$MARKER" ]; then
  echo "❌ You have un-verified changes. Run \`dev check\`"
  exit 1
fi

# Check if any modified tracked file is newer than the marker
for file in $(git ls-files -m); do
  if [ -f "$file" ] && [ "$file" -nt "$MARKER" ]; then
    echo "❌ You have un-verified changes. Run \`dev check\`"
    exit 1
  fi
done

exit 0
